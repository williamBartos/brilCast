<!DOCTYPE html>
<meta charset="utf-8">

<style>
.axis text {
  font: 10px sans-serif;
}


.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis--x path {
  display: none;
}

.legend {
   font-size: 12px;
}

</style>


<body>
<script src="//d3js.org/d3.v3.min.js"></script>
	<script>
		var measurements = ["outTempMax", "outTempMin"]
		var legendRectSize = 18;
		var legendSpacing = 4;
		var legendNames = ["Outdoor High Temperature", "Outdoor Low Temperature"]
		
		var margin = {top: 20, right: 150, bottom: 80, left: 50},
		width = 1020 - margin.left - margin.right,
		height = 500 - margin.top - margin.bottom;
		
		var formatDate = d3.time.format("%Y-%m-%d %H:%M:%S").parse;
		
		var x = d3.scale.ordinal()
			.rangeRoundBands([0, width]);

		var y = d3.scale.linear().rangeRound([height,100]);
		
		var z = d3.scale.category10();
		
		var xAxis = d3.svg.axis()
			.scale(x)
			.orient("bottom")
			.tickFormat(d3.time.format("%b-%d"))
			
		var yAxis = d3.svg.axis()
			.scale(y)
			.orient("left");
			
		var svg = d3.select("body")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			.append("g")
				.attr("transform", 
					  "translate (" + margin.left + "," + margin.top + ")");
			
		d3.json("/data/week",function(error, data) {
		
			data.forEach(function(d) {
			d.timeStamps = formatDate(d.timeStamps);
			d.outTempMax = parseFloat(d.outTempMax);
			d.outTempMin = parseFloat(d.outTempMin);})
			
			var layers = d3.layout.stack()(measurements.map(function (c) {
				return data.map(function(d) {
				return {x: d.timeStamps, y: d[c]};
				});
			}));
				
			x.domain(layers[0].map(function (d) {return d.x;}));
			
			y.domain([0, d3.max(layers[layers.length - 1], function(d) { return d.y+10})]).nice();
			
			var layer = svg.selectAll(".layer")
				.data(layers)
				.enter().append("g")
					.attr("class", "layer")
					.style("fill", function(d, i) {return z(i);});
			
			layer.selectAll("rect")
				.data(function (d) {return d;})
				.enter().append("rect")
					.attr("x", function (d) { return x(d.x); })
					.attr("y", function(d) { return height-0.5; })
					.attr("height", 0)
					.transition()
					.duration(2000)
						.attr("stroke-dashoffset", 0)
						.attr("y", function(d) { return y(d.y); })
						.attr("height", function(d) { return y(d.y0) - y(d.y + d.y0); })
						.attr("width", x.rangeBand()-5);
	
			svg.append("g")
				.attr("class", "axis axis--x")
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis);
				
			svg.append("g")
				.attr("class", "axis axis--y")
				.call(yAxis);
				
			var legend = layer.selectAll(".legend")
				.data(function (d) {return measurements})
				.enter().append("g")
				  .attr("class", "legend")
				  .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; })
				  .style("font", "10px sans-serif");

			  legend.append("rect")
				  .attr("x", width - 18)
				  .attr("width", 18)
				  .attr("height", 18)
				  .style("opacity", "0")
				  .transition()
					.duration(2500)
					.style("opacity", "1")
				  .style("fill", function(d, i) {return z(i);});

			  legend.append("text")
				  .attr("x", width - 24)
				  .attr("y", 9)
				  .attr("dy", ".35em")
				  .attr("text-anchor", "end")
				   .style("opacity", "0")
				  .transition()
					.duration(2500)
						.style("opacity", "1")
						.style("fill", function(d, i) {return z(i);})
						.text(function(d,i) { return legendNames[i]; });
								

		});
	</script>
</body>

</html>

		
		
